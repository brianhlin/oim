#!/usr/bin/python
 
import urllib
import httplib
import M2Crypto

ctx = M2Crypto.SSL.Context()
ctx.load_cert("/home/hayashis/.globus/soichi.2014.pem")
 
params = urllib.urlencode({
'csrs': ["MIIC5DCCAcwCAQAwgZ4xCzAJBgNVBAYTAlVTMRAwDgYDVQQIEwdJbmRpYW5hMRQwEgYDVQQHEwtCbG9vbWluZ3RvbjEbMBkGA1UEChMSSW5kaWFuYSBVbml2ZXJzaXR5MQ0wCwYDVQQLEwRVSVRTMRswGQYDVQQDExJzb2ljaGkuZ3JpZC5pdS5lZHUxHjAcBgkqhkiG9w0BCQEWD2hheWFzaGlzQGl1LmVkdTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAM6TXTvVBUl2Rw1cLaJuF0zqOXxHmtizF/BRE16RxPS88AyAYgnMg5Aa+emqJXaMfeh2zXifoi0yPKsRJwztLrxSU8IXlzcUZ0mBEK+gzfK7GtFV5sRL4ecdYR1R9XVlj2iL0FpLknBJHQb9I7+WQ6rC9yhwKoH7Sm5EaNWo2ty4YVcarNw7pptizRVAUW972+jvcCNJWZyNJJtyKJOR0zkulYyXPohW5ovcT0hyCs9XTYNNg/O02fI1sEzEyOfoBNoHy06UH0L0xw9AkxwUmlzyZr+NB2OuhCEjm/QUefMgh+c8PFxbcW69M0lGR4A20ZJsd+2hui1Cz1wWfSIqqBMCAwEAAaAAMA0GCSqGSIb3DQEBBQUAA4IBAQC26RTFELEb0NhkmIarz/t1IciqbuYN1WIwfRpn5yIR7WiSquA6BwR1Ie6mpOlJNzj5PflQU1FJNeMxWUc7vFsUsupv9y1Pv0MpMXX9iSYPYjym3IA0I2D/CIdVVwpOpjTJJhCI/r5LGiZIKWxv4prjMc47ctWm8rPu1TmH3fEX8ZeQ2ZNU/VMJgymaT3CFIWanYbJnkWCFigzBkrh7aaE1zDWrDKV3EQs3N+i5NzFhM6pg6Ix/5lLs8skR/aR4v2OMI/8JawkWkgn9WqCY6dIm+1af9zikTlPRehbt4VzYsLJijOCPXkUVNb4jr2oKlBc4Vqo4OjfpakA4n6yseH0F",
"MIIC5TCCAc0CAQAwgZ8xCzAJBgNVBAYTAlVTMRAwDgYDVQQIEwdJbmRpYW5hMRQwEgYDVQQHEwtCbG9vbWluZ3RvbjEbMBkGA1UEChMSSW5kaWFuYSBVbml2ZXJzaXR5MQ0wCwYDVQQLEwRVSVRTMRwwGgYDVQQDExNzb2ljaGkyLmdyaWQuaXUuZWR1MR4wHAYJKoZIhvcNAQkBFg9oYXlhc2hpc0BpdS5lZHUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCdA5DsTY2MkQ2LD4NktKeEeC++mkqb4zxxUQOcyNQneb0P9DY1PCo1JJgRWTTk8EbM9neR+cIezqE3eB0/iwn/lF4eG2tVIwlwST8x76YUJNdn61WephiHlX6TrBDTMz+LJqWfA3AyEXth4dS6TPEkoMtG8erfogOjb+tcATpviHFCOazvyRHIyRRxfxOYgrDfAWFDyRFTmBhzQ0U6xjmVsyfRjiPc4OvMYZqRyEmL0dlOg/V+FWciGo2AnAq2TfJTja7WI6/sBNu3G7ZltgWtx8+2eO5e4KPQOZao+gAj+YgCd/2GFllaQvtyDeUL5yXgQijDLREQ1uV9bLk9CSMTAgMBAAGgADANBgkqhkiG9w0BAQUFAAOCAQEAQSl/eQ7EJ/8QGu7Nuj7NSEDBDB6/zkCkjAlseGjwv4p0AJLuqIXbYCzYFIJfRfChXEN56aipFsoR6v5GhaZTag1yw6KIzFHl8WB4GQd9rYFhWbJIQzJib4WJ0e1M2FpFAuW6uyO9BCSXwliAdbUCh8TfyCoPfk/EHiSUnT3Yj2YDLof2Eh2v4cqhZv86AoA0rj5hlvCm/k8NMcKX2c4DrUQv5677oI0ah1gmpVfQPyrT49R6EREUmLWaJ34lgbRu/NaE0XKy8f11pll1cUBcC9AgqdLE3w09UobOpqQyPOzhiJAFIgj0FsmmO+VNu7ezROGuJZYdeMkNiNpmeDCltg=="]
}, True) #doseq
 
headers = {'Content-type': 'application/x-www-form-urlencoded', 'User-Agent': 'Test Client'}
conn = M2Crypto.httpslib.HTTPSConnection("oim-itb.grid.iu.edu", ssl_context=ctx)
conn.set_debuglevel(1)
conn.request("POST", "/oim/rest?action=host_certs_request&version=1", params, headers)

response = conn.getresponse()
print response.status, response.reason
data = response.read()
conn.close()
print data
